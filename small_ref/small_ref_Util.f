C ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
C                                                                  
C Auxiliary Routines File                                          
C                                                                  
C Generated by KPP-2.2.3 symbolic chemistry Kinetics PreProcessor  
C       (http://www.cs.vt.edu/~asandu/Software/KPP)                
C KPP is distributed under GPL, the general public licence         
C       (http://www.gnu.org/copyleft/gpl.html)                     
C (C) 1995-1997, V. Damian & A. Sandu, CGRER, Univ. Iowa           
C (C) 1997-2005, A. Sandu, Michigan Tech, Virginia Tech            
C     With important contributions from:                           
C        M. Damian, Villanova University, USA                      
C        R. Sander, Max-Planck Institute for Chemistry, Mainz, Germany
C                                                                  
C File                 : small_ref_Util.f                          
C Time                 : Wed Mar  9 12:16:21 2022                  
C Working directory    : /home/kyriacos/CyprusInstitute/kpp/small_ref
C Equation file        : small_ref.kpp                             
C Output root filename : small_ref                                 
C                                                                  
C ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~




C User INLINED Utility Functions                                   

C End INLINED Utility Functions                                    

C Utility Functions from KPP_HOME/util/util                        
C ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
C                                                                  
C UTIL - Utility functions                                         
C   Arguments :                                                    
C                                                                  
C ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

C ****************************************************************
C                            
C InitSaveData - Opens the data file for writing
C   Parameters :                                                  
C
C ****************************************************************

      SUBROUTINE InitSaveData ()

      INCLUDE 'small_ref_Parameters.h'

      open(10, file='small_ref.dat')

      RETURN
      END

C End of InitSaveData function
C ****************************************************************

C ****************************************************************
C                            
C SaveData - Write LOOKAT species in the data file 
C   Parameters :                                                  
C
C ****************************************************************

      SUBROUTINE SaveData ()

      INCLUDE 'small_ref_Parameters.h'
      INCLUDE 'small_ref_Global.h'

      INTEGER i

      WRITE(10,999) (TIME-TSTART)/3600.D0,
     *              (C(LOOKAT(i))/CFACTOR, i=1,NLOOKAT)
999   FORMAT(E24.16E3,100(1X,E24.16E3))
      RETURN
      END

C End of SaveData function
C ****************************************************************

C ****************************************************************
C                            
C CloseSaveData - Close the data file 
C   Parameters :                                                  
C
C ****************************************************************

      SUBROUTINE CloseSaveData ()

      INCLUDE 'small_ref_Parameters.h'

      CLOSE(10)

      RETURN
      END

C End of CloseSaveData function
C ****************************************************************

C ****************************************************************
C                            
C GenerateMatlab - Generates MATLAB file to load the data file 
C   Parameters : 
C                It will have a character string to prefix each 
C                species name with.                                                 
C
C ****************************************************************

      SUBROUTINE GenerateMatlab ( PREFIX )

      INCLUDE 'small_ref_Parameters.h'
      INCLUDE 'small_ref_Global.h'
      
      CHARACTER*8 PREFIX 
      INTEGER i

      open(20, file='small_ref.m')
      write(20,*) 'load small_ref.dat;'
      write(20,990) PREFIX
990   FORMAT(A1,'c = small_ref;')
      write(20,*) 'clear small_ref;'
      write(20,991) PREFIX, PREFIX
991   FORMAT(A1,'t=',A1,'c(:,1);')
      write(20,992) PREFIX
992   FORMAT(A1,'c(:,1)=[];')

      do i=1,NLOOKAT
        write(20,993) PREFIX, SPC_NAMES(LOOKAT(i)), PREFIX, i
993     FORMAT(A1,A6,' = ',A1,'c(:,',I2,');')
      end do
      
      CLOSE(20)

      RETURN
      END

C End of GenerateMatlab function
C ****************************************************************

C End Utility Functions from KPP_HOME/util/util                    
C End of UTIL function                                             
C ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


C ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
C                                                                  
C Shuffle_user2kpp - function to copy concentrations from USER to KPP
C   Arguments :                                                    
C      V_USER    - Concentration of variable species in USER's order
C      V         - Concentrations of variable species (local)      
C                                                                  
C ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

      SUBROUTINE Shuffle_user2kpp ( V_USER, V )

      IMPLICIT NONE
      INCLUDE 'small_ref_Parameters.h'

C V_USER - Concentration of variable species in USER's order       
      REAL*8 V_USER(NVAR)
C V - Concentrations of variable species (local)                   
      REAL*8 V(NVAR)

      V(2) = V_USER(1)
      V(1) = V_USER(2)
      V(3) = V_USER(3)
      V(4) = V_USER(4)
      V(5) = V_USER(5)
      RETURN
      END

C End of Shuffle_user2kpp function                                 
C ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


C ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
C                                                                  
C Shuffle_kpp2user - function to restore concentrations from KPP to USER
C   Arguments :                                                    
C      V         - Concentrations of variable species (local)      
C      V_USER    - Concentration of variable species in USER's order
C                                                                  
C ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

      SUBROUTINE Shuffle_kpp2user ( V, V_USER )

      IMPLICIT NONE
      INCLUDE 'small_ref_Parameters.h'

C V - Concentrations of variable species (local)                   
      REAL*8 V(NVAR)
C V_USER - Concentration of variable species in USER's order       
      REAL*8 V_USER(NVAR)

      V_USER(1) = V(2)
      V_USER(2) = V(1)
      V_USER(3) = V(3)
      V_USER(4) = V(4)
      V_USER(5) = V(5)
      RETURN
      END

C End of Shuffle_kpp2user function                                 
C ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


C ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
C                                                                  
C GetMass - compute total mass of selected atoms                   
C   Arguments :                                                    
C      CL        - Concentration of all species (local)            
C      Mass      - value of mass balance                           
C                                                                  
C ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

      SUBROUTINE GetMass ( CL, Mass )

      IMPLICIT NONE
      INCLUDE 'small_ref_Parameters.h'

C CL - Concentration of all species (local)                        
      REAL*8 CL(NSPEC)
C Mass - value of mass balance                                     
      REAL*8 Mass(1)

      Mass(1) = CL(4)+CL(5)+CL(6)+CL(6)
      RETURN
      END

C End of GetMass function                                          
C ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


