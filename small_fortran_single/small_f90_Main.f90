! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
! 
! Main Program File
! 
! Generated by KPP-2.2.3 symbolic chemistry Kinetics PreProcessor
!       (http://www.cs.vt.edu/~asandu/Software/KPP)
! KPP is distributed under GPL, the general public licence
!       (http://www.gnu.org/copyleft/gpl.html)
! (C) 1995-1997, V. Damian & A. Sandu, CGRER, Univ. Iowa
! (C) 1997-2005, A. Sandu, Michigan Tech, Virginia Tech
!     With important contributions from:
!        M. Damian, Villanova University, USA
!        R. Sander, Max-Planck Institute for Chemistry, Mainz, Germany
! 
! File                 : small_f90_Main.f90
! Time                 : Thu Jan 27 17:32:38 2022
! Working directory    : /home/kyriacos/CyprusInstitute/kpp/small_fortran_single
! Equation file        : small_f90.kpp
! Output root filename : small_f90
! 
! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~



! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
! 
! MAIN - Main program - driver routine
!   Arguments :
! 
! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

PROGRAM small_f90_Driver

  USE small_f90_Model
  USE small_f90_Initialize, ONLY: Initialize

      REAL(kind=sp) :: T, DVAL(NSPEC)
      REAL(kind=sp) :: RSTATE(20)
      REAL(kind=dp) :: START, FINISH
      INTEGER :: i,j
      
!~~~> Initialization 

      STEPMIN = 0.0d0
      STEPMAX = 0.0d0

      DO i=1,NVAR
        RTOL(i) = 1.0d-1
        ATOL(i) = 1.0
      END DO
      CALL cpu_time(START)
      DO j=1, 100000
            CALL Initialize()

            ! CALL InitSaveData()

      !~~~> Time loop
            T = TSTART
      kron: DO WHILE (T < TEND)

            TIME = T
            CALL GetMass( C, DVAL )
            ! WRITE(6,991) (T-TSTART)/(TEND-TSTART)*100, T,       &
                        ! ( TRIM(SPC_NAMES(MONITOR(i))),           &
                        ! C(MONITOR(i))/CFACTOR, i=1,NMONITOR )
            !   CALL SaveData()
            CALL Update_SUN() 
            CALL Update_RCONST()

            CALL INTEGRATE( TIN = T, TOUT = T+DT, RSTATUS_U = RSTATE, &
            ICNTRL_U = (/ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 /) )
            T = RSTATE(1)

            END DO kron
      !~~~> End Time loop

            CALL GetMass( C, DVAL )
            ! WRITE(6,991) (T-TSTART)/(TEND-TSTART)*100, T,     &
                  ! ( TRIM(SPC_NAMES(MONITOR(i))),           &
                  ! C(MONITOR(i))/CFACTOR, i=1,NMONITOR ) 
            TIME = T
            ! CALL SaveData()
            ! CALL CloseSaveData()
      END DO
      CALL cpu_time(FINISH)
      PRINT '("Time = ",f10.6," seconds.")',FINISH-START
991   FORMAT(F6.1,'%. T=',E9.3,2X,200(A,'=',E11.4,'; '))

END PROGRAM small_f90_Driver

! End of MAIN function
! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


